课程标题：5.构建一个每天给自己推荐吃什么的自动化工作流
# 板块一：课程回顾
## 一、课程回顾
1. json数据的结构与语法
2. 数据处理节点的不同类型与使用方法
3. N8N中数据的读取方式
4. 不同类型的数据进行转换和格式化处理；
## 二、学习目标
1. 飞书应用的创建，
2. 创建个人的常用数据库以及了解如何给数据打标签
3. 简单工作流逻辑的分析与判断
4. 实现给自己推荐吃什么的自动化工作流
## 三、课程内容
1. 动手搭建一个每天给自己推荐吃什么的自动化工作流
# 板块二：课程内容
## 一、案例实战：
### （一）案例主题
构建一个完整的自动化工作流：
每天11点，从个人数据库中选择一个菜品主题，准时的给朋友发送一条图片+描述的美食推荐邮箱。
## 二、案例分析
### （一）工作流逻辑分析
1. 每天都会按时触发
2. 自己去读取数据库中的数据
	- 需要根据什么样的标签与字段去寻找
3. 自己根据主题生成提示词
	- 需要规定好格式
	- 包含图片提示词与生成文案的提示词
4. 发送给好友的邮箱
### （二）工作流技术选型
1. 触发器模块-定时触发器
2. 调取数据模块-飞书节点
3. 提示词生成模块-AI agent节点、模型配置、格式化生成器
4. 内容生成模块-HTTP请求节点、Gemini节点
5. 发送邮箱模块- Send Email
## 三、案例实现步骤
### （一）定时触发节点配置
1. 选择触发器节点
2. 时间设置为11.00AM
### （二）飞书的应用创建及权限设置
1. 打开飞书，进入飞书开发者平台[https://open.feishu.cn/?lang=zh-CN]
2. 进入开发者后台并点击创建企业自建应用
3. **应用名称**填写**n8n**；**描述**添加**自动化工作流应用**并发布
4. 点击进入应用界面，在应用凭证一栏复制**APPid与appsecret**
5. 回到n8n中创建飞书凭证，将复制到的**APPid与APPsecret**填入相对应的位置
6. 点击权限管理，选择开通权限。
7. 点击**多维表格**选项，
8. 点击全选，确认开通权限授予多维表格权限
9. 开通后状态
### （三）多维表格配置
1. 活到飞书主页，点击右侧的云文档，点击新建多维表格
2. 创建一个名称为菜单的多维表格
3. 按示例图创建并填写数据
4. 点击右上角**符号...>更多>添加文档应用**
5. 搜索上衣创建的名为n8n的飞书应用，并选择将多为表格添加至飞书应用
### （四）飞书节点配置
1. 创建**多维表格>查询记录**的飞书节点
2. 填入多维表格的token与id，查看飞书多维表格的url
3. 书写请求体“查询饭点内容为午餐、标签为未生成的记录”
	- 请求体示例
```
{
  "filter": {
    "conjunction": "and",
    "conditions": [
      {
        "field_name": "饭点",
        "operator": "is",
        "value": ["午餐"]
      },
      {
        "field_name": "标签",
        "operator": "is",
        "value": ["未生成"]
      }
    ]
  }
}
```
3. 创建第二个飞书节点，这个节点的功能为更新记录
4. 记录id将re-id拖拽至选框，
5. 后书写请求体：”标签字段填入已生成“
```
{
  "fields": {
    "标签": "已生成"
  }
}

```
### （三）AI agent节点_生成提示词
1. 创建AI agent节点
2. 配置大模型（deepseek）
3. 书写撰写提示词的提示词
	- 文案提示词
	- 图片提示词
4. 配置结构化输出解析器
5. 编写JSON格式
### （四）配置HTTP请求节点_生成文案
1. 创建HTTP请求节点
2. 配置deepseek的curl
3. 配置headers与body
4. 配置body的json正文
### （五）配置Gemini节点_生成图像
1. 配置Google gemini API
2. 模型配置
### （六）配置Send Email节点
1. 开启QQ邮箱→设置→账号设置→IMAP/SMTP功能
2. 开启之后并复制授权码
3. 配置SMTP账户
	- user：你的QQ邮箱
	- password：刚刚复制的授权码
	- host：smtp.qq.com
	- port：465
	- SSL/TLS：开启
	- client host name：不需要填
4. 配置节点的内部内容
	- operation：send
	- From Email：填写你的QQ邮箱
	- TO Email：填写接受邮件的邮箱
	- Subject：邮件标题
	- Email Format：邮件格式，跟随内容确定是text还是html
	- options：添加attachments与取消append n8n attribution
# 板块三：课后作业
