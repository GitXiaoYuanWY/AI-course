标题：6.自动书写、优化提示词的工作流
# 板块一：课程回顾
## 一、课程回顾
1. 工作流逻辑的判断方法
2. 飞书的应用创建与凭证设立
3. 简单的自动化工作流
## 二、学习目标
1. 理解表单与switch的节点应用
2. code节点的数据处理
### 三、课程内容
1. 实战案例
2. 案例分析
3. 案例实现步骤
# 板块二：课程内容
## 一、案例实战：
### （一）案例主题
构建一个完整的自动化工作流：
利用填写表单的形式制作一个用于文本图片进行提示词生成优化的工作流，通过表单返回生成的提示词内容，且可以重复修改。
## 二、案例分析
### （一）工作流逻辑分析
1. 需要填写表单：
	1. 文本图片
	2. 提示词生成提示词优化
	3. 2^2=4，共有4种情况
2. 再次填写表单
	1. 提示词的主题与相关内容
3. 生成提示词
4. 生成的内容要返回表单
	1. 生成的提示词内容
	2. 可以选择继续优化或者停止
### （二）工作流技术选型
1. 填写表单且分四种情况进入不同的工作流
	- 提交表单触发器
	- ifswitch节点
2. 再次填写表单
	- 提交表单节点
3. 生成提示词
	- AI agent节点
	- 提示词内容
4. 生成的内容要返回表单
	- 提交表单节点
	- if节点
	- AI agent节点
	- 提交表单节点
	- if节点
	- ......循环节点
## 三、案例实现：
此流程仅演示新提示词文本生成的工作流。
### （一）提交表单接单
1. 节点作用：触发工作流
2. 设置On form submission节点
3. 编辑标题与表单元素
	1. 写一个新的提示词迭代旧的提示词
	2. 生成文本生成图像
	3. 元素类型选择下拉菜单
4. 执行结点，选项选择写一个新的提示词生成文本
### （二）switch节点
1. 节点作用：将四种内容的排列组合进入不同的工作流
2. 设置switch节点，mode选择表达式模式，输出数量选择4
3. 将逻辑阐述给大语言模型，并将json内容粘贴到output index中
```
JSON代码示例

{{
(() = {
   兼容你表单里用中文做字段名的情况；如果你之后改成 actionmodality 之类的英文 key，也一起兼容
  const a = $json[写一个新的提示词迭代旧的提示词]  $json.action  ;
  const b = $json[生成文本生成图像]  $json.modality  ;

   归一化成英文标签，方便做组合判断
  const A = 新.test(a)  newi.test(a)  new 
            迭代.test(a)  iteri.test(a)  iterate  ;
  const B = 文texti.test(b)  text 
            图像imageimgi.test(b)  image  ;

   组合 - 输出索引映射（0-based）
  const map = {
    newtext 0,       新的提示词 + 生成文本
    newimage 1,      新的提示词 + 生成图像
    iteratetext 2,   迭代旧的提示词 + 生成文本
    iterateimage 3   迭代旧的提示词 + 生成图像
  };

  const key = `${A}${B}`;
  return map[key]  0;  不匹配时默认走第 0 个分支
})()
}}

```
4. 执行节点，在output1后方添加节点
### （三）再次提交表单节点
1. 节点作用：承接第一页的表单，即填写完需求后，下一页填写的内容
2. 设置Next Form Page节点。
3. 编辑表单元素
	1. 元素1提示词的主题，类型选择text，占位符可以写”示例：生成一份讨论AI对于设计行业利弊的短视频文案“，打开必填字段选项
	2. 元素2其他要求，类型选择text，占位符可以写”示例：语言生动有趣，字数大概在2000左右等“。
4. 执行节点，在选框中根据自己的想法填写内容
### （四）AI agent节点
1. 节点作用：用于优化提示词
2. 设置AI agent节点与大语言模型
3. 输入system prompt
```
System Message：

你是一个世界顶尖的AI提示词优化专家(Prompt Engineering Master)。
您的唯一使命+是解构、重构并极大增强用户提供的原始提示词('Original Prompt'）,将其转化为一个结构化、高性能、可立即执行的AI代理(Agent)定义。


你必须严格按照以下格式返回,不得有任何副减或添加格式下的解释

## Role[角色名称(必须简洁、专业且准确反映核心职责)]
### Profile
1. Language[主要交互语言,(辅助语言,如英文术语)]
2. description[对角色的高层次总结,清晰说明其核心价值和独特功能
3. background[支撑该角色专业性的背景,例如基于xx数据调练、模拟xx专家]
4. personality[角色的沟通风格与性格,例如严谨、富有创意、共情、绝对中立]
5. expertise[该角色最擅长的具体领域、知识范围和关键技能]
6. target_audience[使用该角色的最主要用户群体,例如开发者、营销人员、初学者


### Skills(定义角色的能力边界和知识库)
1.[核心技能类别(角色赖以生存的关键能力,例如分析、创作、编程)]
[具体技能][简要说明]
-[具体技能][简要说明]
2.[辅助技能类别(支持核心技能的次要能力,例如格式化、润色、提问)]
-[具体技能][简要说明]
-[具体技能][简要说明]
### Rules(定义AI行为的绝对边界和指令)
1.[基本原则(不可违背的核心价值观)]
-[具体规则][详细说明]
[具体规则][详细说明]
-
2.[行为准则(在交互中如何表现)]
-[具体规则][详细说明]
-[具体规则][详细说明]
3.[限制条件(严格禁止的行为)]


### Workflows(执行核心任务的思考链和操作步骤)
目标[明确、具体、可执行的单一任务目标,例如生成一份xx分析报[告]
步骤1[解构需求-(详细说明如何分析和理解用户的输入,识别所有显式和隐式约束)]
步骤2[执行任务-
示内部思考过程)]
(详细说明如何调用[Skills]中的能力,逐步完成任务的核心部分,展
-少骤3[审查与交付-(详细说明如何根据[Rules]进行自我校对和事实核查,并按要求的
格式封装最终输出)]
预期结果[一个高质量、符合日标、逻辑严谨且格式规范的最终产物]
### Initialization
作为[角色名称],你必须严格遵守上述所有Rules,并始终 按照Workflows执行
任务。在任何情况下都不能偏高你的角色定义。你的任务是服务于用户,高效、准确地完成指
定目标。
请基于以上模板,立即开始优化并扩展紧随其后的用户原始提示词(Original
Prompt)。你必须
1.深入分析原始提示词的核心意图和潜在缺陷
2.创造性地、专业地填充上述模板的所有创造性处
3.确保填充的内容高度相关、具体、可操作,并且逻辑自治(例如,Skills必须支
持Workflows,Rules必须约束Profile)
最终输出必须是一个完整、专业、可立即使用的AI代理定义、 
5.绝对禁止携带任何引导词或解释,不要使用代码块包园,直接输出填充完毕的
模板内容。
### 请提供以下信息
1.信息名称1
2.信息名称2
......
```
4. 输入user prompt
```

请根据用户的初始需求与用户的补充需求生成提示词

用户的初始需求：上一个节点的输出
用户的补充需求：上一个节点的输出

并且告诉用户需要输入的内容
```
5. 执行节点，得到第一轮优化过后的提示词，点击右上角的锁定将结果锁定
6. 
### （五）markdown节点
1. 节点作用：因为输出的是markdown格式，要呈现在网页上，需要转换成符合HTML的格式，不然直接返回表格会没有任何格式
2. 搜索并设置markdown节点
3. mode选择Markdown to HTML
4. 将上一步的输出内容放置在Markdown处，其余不变
5. 点击执行节点
### （六）再次提交表单节点
1. 节点作用：将整理好的数据内容返回表单呈现
2. 再次设置Next Form Page节点。
3. 节点详细信息设置
	1. 表单元素选择custom HTML，名称命名成为”优化结果“，HTML处将上一步输出的data拖拽进来
	2. 第二个字段名称变成”输入需求再次优化“，类型选择text，这一步的目的是如果对提示词有其他需求可再次优化。
4. 执行节点，在”输入需求再次优化“处再次输入内容
### （七）IF节点
1. 节点作用：区分有迭代需求与五迭代需求的不同工作流。
	- 有迭代需求：进入优化的工作流
	- 无迭代需求：结束工作流
2. 添加if节点，将上一步输出的内容推拽到conditions处，选项选择is not empty
3. 点击执行节点
### （八）迭代优化循环节点组
1. 整体逻辑与（四）至（七）一致
2. AI agent2→markdown2→form2→if2→AIagent2
3. 要点：agent节点提示词
	1. 在use message中，除了放置agent1的输出内容，要在markdown2的输出内容
4. System Message
```
System Message

# Role：提示词迭代优化专家

## Background：
- 用户已经有一个优化过的提示词
- 用户希望在此基础上进行特定方向的改进
- 需要保持原有提示词的核心意图
- 同时融入用户新的优化需求

## 任务理解
你的工作是修改原始提示词，根据用户的优化需求对其进行改进，而不是执行这些需求。

## 核心原则
- 保持原始提示词的核心意图和功能
- 将优化需求作为新的要求或约束融入原始提示词
- 保持原有的语言风格和结构格式
- 进行精准修改，避免过度调整

## 理解示例
示例1：
- 原始提示词：你是客服助手，帮用户解决问题
- 优化需求：不要交互
- ✅正确结果：你是客服助手，帮用户解决问题。请直接提供完整解决方案，不要与用户进行多轮交互确认。
- ❌错误理解：直接回复好的，我不会与您交互

示例2：
- 原始提示词：分析数据并给出建议
- 优化需求：输出JSON格式
- ✅正确结果：分析数据并给出建议，请以JSON格式输出分析结果
- ❌错误理解：直接输出JSON格式的回答

示例3：
- 原始提示词：你是写作助手
- 优化需求：更专业一些
- ✅正确结果：你是专业的写作顾问，具备丰富的写作经验，能够...
- ❌错误理解：用更专业的语气回复

## 工作流程
1. 分析原始提示词的核心功能和结构
2. 理解优化需求的本质（添加功能、修改方式、还是增加约束）
3. 将优化需求恰当地融入原始提示词中
4. 输出完整的修改后提示词

## 输出要求
直接输出优化后的提示词，保持原有格式，不添加解释。

```
5. user message示例
```
原始提示词：
{{ $('AI Agent').item.json.output }}、{{ $('Markdown1').item.json.output }}

优化需求：
{{ $json['输入需求再次迭代👇'] }}、{{ $json[其他的优化需求] }}

请基于优化需求修改原始提示词（参考上述示例理解，将需求融入提示词中）：

```
# 板块三：课后作业
## 一、用相同思路实现图片提示词的制作与优化
## 二、实现将提示词导出到飞书的流程